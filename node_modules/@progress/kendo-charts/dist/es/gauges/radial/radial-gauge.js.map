{"version":3,"file":"radial-gauge.js","sources":["radial-gauge.js"],"sourcesContent":["import { geometry as geo, drawing } from '@progress/kendo-drawing';\nimport { setDefaultOptions, deepExtend, round, isArray } from '../../common';\nimport { COORD_PRECISION } from '../../common/constants';\nimport Gauge from '../gauge';\nimport RadialScale from './radial-scale';\nimport RadialPointer from './radial-pointer';\n\nconst Group = drawing.Group;\n\nclass RadialGauge extends Gauge {\n\n    reflow(bbox) {\n        const pointers = this.pointers;\n        this.scale.reflow(bbox);\n        this._initialPlotArea = this.scale.bbox;\n\n        for (let i = 0; i < pointers.length; i++) {\n            pointers[i].reflow(this.scale.arc);\n            this._initialPlotArea = geo.Rect.union(this._initialPlotArea, pointers[i].bbox);\n        }\n\n        this.fitScale(bbox);\n        this.alignScale(bbox);\n        this._buildVisual(this.gaugeArea, pointers, this.scale);\n        this._draw();\n    }\n\n    _buildVisual(gaugeArea, pointers, scale) {\n        const visuals = this._visuals = new Group();\n\n        visuals.append(gaugeArea);\n        visuals.append(scale.ticks);\n        visuals.append(scale.ranges);\n        this._buildPointers(pointers);\n        visuals.append(scale.labelElements);\n    }\n\n    _buildPointers(pointers) {\n        for (let i = 0; i < pointers.length; i++) {\n            const current = pointers[i];\n            current.render();\n            this._visuals.append(current.elements);\n\n            current.value(current.options.value);\n        }\n    }\n\n    fitScale(bbox) {\n        const arc = this.scale.arc;\n        const plotAreaBox = this._initialPlotArea;\n        const step = Math.abs(this.getDiff(plotAreaBox, bbox));\n        let min = round(step, COORD_PRECISION);\n        let max = round(-step, COORD_PRECISION);\n        let minDiff, midDiff, maxDiff, mid, oldDiff;\n        let staleFlag = 0;\n        let i = 0;\n\n        while (i++ < 100) {\n            staleFlag = (oldDiff === maxDiff) ? (staleFlag + 1) : 0;\n\n            if (staleFlag > 5) {\n                break;\n            }\n\n            if (min !== mid) {\n                minDiff = this.getPlotBox(min, bbox, arc);\n                if (0 <= minDiff && minDiff <= 2) {\n                    break;\n                }\n            }\n\n            if (max !== mid) {\n                maxDiff = this.getPlotBox(max, bbox, arc);\n                if (0 <= maxDiff && maxDiff <= 2) {\n                    break;\n                }\n            }\n\n            if (minDiff > 0 && maxDiff > 0) {\n                mid = min * 2;\n            } else if (minDiff < 0 && maxDiff < 0) {\n                mid = max * 2;\n            } else {\n                mid = round(((min + max) / 2) || 1, COORD_PRECISION);\n            }\n\n            midDiff = this.getPlotBox(mid, bbox, arc);\n            if (0 <= midDiff && midDiff <= 2) {\n                break;\n            }\n\n            oldDiff = maxDiff;\n\n            if (midDiff > 0) {\n                max = mid;\n                maxDiff = midDiff;\n            } else {\n                min = mid;\n                minDiff = midDiff;\n            }\n        }\n    }\n\n    getPlotBox(step, bbox, arc) {\n        const scale = this.scale;\n        const pointers = this.pointers;\n        const radius = arc.getRadiusX();\n        const scaleArc = arc.clone();\n\n        scaleArc.setRadiusX(radius + step).setRadiusY(radius + step);\n\n        scale.arc = scaleArc;\n        scale.reflow(bbox);\n        this.plotBbox = scale.bbox;\n\n        for (let i = 0; i < pointers.length; i++) {\n            pointers[i].reflow(scaleArc);\n            this.plotBbox = geo.Rect.union(this.plotBbox, pointers[i].bbox);\n        }\n\n        return this.getDiff(this.plotBbox, bbox);\n    }\n\n    getDiff(plotBox, box) {\n        return Math.min(box.width() - plotBox.width(), box.height() - plotBox.height());\n    }\n\n    alignScale(bbox) {\n        const plotBoxCenter = this.plotBbox.center();\n        const boxCenter = bbox.center();\n        const paddingX = plotBoxCenter.x - boxCenter.x;\n        const paddingY = plotBoxCenter.y - boxCenter.y;\n        const { scale, pointers } = this;\n\n        scale.arc.center.x -= paddingX;\n        scale.arc.center.y -= paddingY;\n\n        scale.reflow(bbox);\n\n        for (let i = 0; i < pointers.length; i++) {\n            pointers[i].reflow(scale.arc);\n            this.plotBbox = geo.Rect.union(scale.bbox, pointers[i].bbox);\n        }\n    }\n\n    _createModel() {\n        const options = this.options;\n        const pointers = options.pointer;\n        const scale = this.scale = new RadialScale(options.scale, this.contextService);\n\n        this.pointers = [];\n\n        const pointersArr = isArray(pointers) ? pointers : [ pointers ];\n        for (let i = 0; i < pointersArr.length; i++) {\n            const current = new RadialPointer(scale, deepExtend({}, pointersArr[i], {\n                animation: {\n                    transitions: options.transitions\n                }\n            }));\n\n            this.pointers.push(current);\n        }\n    }\n}\n\nsetDefaultOptions(RadialGauge, {\n    transitions: true,\n    gaugeArea: {\n        background: \"\"\n    }\n});\n\nexport default RadialGauge;"],"names":["const","let","this"],"mappings":"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"}